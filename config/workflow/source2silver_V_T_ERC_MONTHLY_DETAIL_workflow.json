{
  "dag_id": "source2silver_V_T_ERC_MONTHLY_DETAIL_workflow",
  "description": "source -> bronze -> silver",
  "schedule": "0 1 * * *",
  "start_date": "2025-01-01 00:00:00",
  "active": true,
  "tags": ["source2bronze", "bronze2silver"],
  "default_args": {
    "owner": "cmc_team",
    "email": ["dqthinh1@cmcglobal.vn"],
    "retries": 2,
    "retry_delay": "300"
  },
  "tasks": [
    {
      "task_id": "source2bronze_V_T_ERC_MONTHLY_DETAIL",
      "task_type": "spark",
      "conn_id": "spark_k8s",
      "task_params": {
        "application": "s3a://asset/spark-jobs/entry_point.py",
        "name": "source2bronze_V_T_ERC_MONTHLY_DETAIL",
        "py_files": "/opt/airflow/dags/src.zip",
        "application_args": [
          "--job_asset_bucket", "asset",
          "--job_input_path", "job-input/source2bronze_V_T_ERC_MONTHLY_DETAIL.json"
        ],
        "conf": {
            "spark.kubernetes.namespace": "compute",
            "spark.kubernetes.container.image": "ghostwood/mbs-spark:1.0.1-oracle",
            "spark.kubernetes.authenticate.driver.serviceAccountName": "spark",
            "spark.sql.extensions": "io.delta.sql.DeltaSparkSessionExtension",
            "spark.sql.catalog.spark_catalog": "org.apache.spark.sql.delta.catalog.DeltaCatalog",
            "spark.sql.catalogImplementation": "hive",
            "spark.hadoop.hive.metastore.uris": "thrift://hive-metastore.metastore.svc.cluster.local:9083",
            "spark.sql.warehouse.dir": "s3a://warehouse/",
            "spark.hadoop.fs.s3a.endpoint": "http://minio.storage.svc.cluster.local:9000",
            "spark.hadoop.fs.s3a.access.key": "minioadmin",
            "spark.hadoop.fs.s3a.secret.key": "minio@demo!",
            "spark.hadoop.fs.s3a.path.style.access": "true",
            "spark.hadoop.fs.s3a.impl": "org.apache.hadoop.fs.s3a.S3AFileSystem",
            "spark.sql.sources.partitionOverwriteMode": "dynamic",
            "spark.eventLog.enabled": true,
            "spark.eventLog.dir": "s3a://spark-logs/events",
            "spark.driver.extraJavaOptions": "-Divy.cache.dir=/tmp -Divy.home=/tmp"
        }
      }
    },
    {
      "task_id": "bronze2silver_V_T_ERC_MONTHLY_DETAIL",
      "task_type": "spark",
      "conn_id": "spark_k8s",
      "depend_on": ["source2bronze_V_T_ERC_MONTHLY_DETAIL"],
      "task_params": {
        "application": "s3a://asset/spark-jobs/entry_point.py",
        "name": "bronze2silver_V_T_ERC_MONTHLY_DETAIL",
        "py_files": "/opt/airflow/dags/src.zip",
        "application_args": [
          "--job_asset_bucket", "asset",
          "--job_input_path", "job-input/bronze2silver_V_T_ERC_MONTHLY_DETAIL.json"
        ],
        "conf": {
          "spark.kubernetes.namespace": "compute",
            "spark.kubernetes.container.image": "ghostwood/mbs-spark:1.0.1-oracle",
            "spark.kubernetes.authenticate.driver.serviceAccountName": "spark",
            "spark.sql.extensions": "io.delta.sql.DeltaSparkSessionExtension",
            "spark.sql.catalog.spark_catalog": "org.apache.spark.sql.delta.catalog.DeltaCatalog",
            "spark.sql.catalogImplementation": "hive",
            "spark.hadoop.hive.metastore.uris": "thrift://hive-metastore.metastore.svc.cluster.local:9083",
            "spark.sql.warehouse.dir": "s3a://warehouse/",
            "spark.hadoop.fs.s3a.endpoint": "http://minio.storage.svc.cluster.local:9000",
            "spark.hadoop.fs.s3a.access.key": "minioadmin",
            "spark.hadoop.fs.s3a.secret.key": "minio@demo!",
            "spark.hadoop.fs.s3a.path.style.access": "true",
            "spark.hadoop.fs.s3a.impl": "org.apache.hadoop.fs.s3a.S3AFileSystem",
            "spark.sql.sources.partitionOverwriteMode": "dynamic",
            "spark.eventLog.enabled": true,
            "spark.eventLog.dir": "s3a://spark-logs/events",
            "spark.driver.extraJavaOptions": "-Divy.cache.dir=/tmp -Divy.home=/tmp"
        }
      }
    }
  ]
}